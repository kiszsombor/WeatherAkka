DROP TABLE if EXISTS WeatherForecast;
DROP TABLE if EXISTS CurrentWeather;

CREATE TABLE CurrentWeather(
	cityid int IDENTITY,
	cityname varchar(50) NOT NULL,
	temperature float NOT NULL,
	windspeed float NOT NULL,
    winddirection float NOT NULL,
    weathercode int NOT NULL,
	time datetime NOT NULL

	CONSTRAINT PK_CurrentWeather_1 PRIMARY KEY (cityid),
	CONSTRAINT UK_CurrentWeather_cityname UNIQUE (cityname)
);

--SELECT CAST('2022-11-21 08:00' AS DATETIME);

-- INSERT CurrentWeather(cityname, temperature, windspeed, winddirection, weathercode, time)
-- VALUES ('Moscow', -5.2, 7.4, 14, 71, '2022-11-18T14:00:00');

SELECT * FROM CurrentWeather;

CREATE TABLE WeatherForecast(
	cityname varchar(50) NOT NULL,
	time DateTime NOT NULL,
	temperature_2m float NOT NULL

	CONSTRAINT FK_WeatherForecast_CurrentWeather FOREIGN KEY (cityname) REFERENCES CurrentWeather (cityname)
);

-- INSERT WeatherForecast(cityname, time, temperature_2m)
-- VALUES ('Moscow', '2022-11-18T14:00:00', -5.2);

SELECT * FROM WeatherForecast;

-- DECLARE @json VARCHAR(MAX);
-- 	SET @json = N'{"latitude":42.6875,"longitude":23.3125,"generationtime_ms":0.23305416107177734,"utc_offset_seconds":0,"timezone":"GMT","timezone_abbreviation":"GMT","elevation":542.0,"current_weather":{"temperature":7.9,"windspeed":15.9,"winddirection":327.0,"weathercode":61,"time":"2022-11-21T08:00"},"hourly_units":{"time":"iso8601","temperature_2m":"Â°C"},"hourly":{"time":["2022-11-21T00:00","2022-11-21T01:00","2022-11-21T02:00","2022-11-21T03:00","2022-11-21T04:00","2022-11-21T05:00","2022-11-21T06:00","2022-11-21T07:00","2022-11-21T08:00","2022-11-21T09:00","2022-11-21T10:00","2022-11-21T11:00","2022-11-21T12:00","2022-11-21T13:00","2022-11-21T14:00","2022-11-21T15:00","2022-11-21T16:00","2022-11-21T17:00","2022-11-21T18:00","2022-11-21T19:00","2022-11-21T20:00","2022-11-21T21:00","2022-11-21T22:00","2022-11-21T23:00","2022-11-22T00:00","2022-11-22T01:00","2022-11-22T02:00","2022-11-22T03:00","2022-11-22T04:00","2022-11-22T05:00","2022-11-22T06:00","2022-11-22T07:00","2022-11-22T08:00","2022-11-22T09:00","2022-11-22T10:00","2022-11-22T11:00","2022-11-22T12:00","2022-11-22T13:00","2022-11-22T14:00","2022-11-22T15:00","2022-11-22T16:00","2022-11-22T17:00","2022-11-22T18:00","2022-11-22T19:00","2022-11-22T20:00","2022-11-22T21:00","2022-11-22T22:00","2022-11-22T23:00","2022-11-23T00:00","2022-11-23T01:00","2022-11-23T02:00","2022-11-23T03:00","2022-11-23T04:00","2022-11-23T05:00","2022-11-23T06:00","2022-11-23T07:00","2022-11-23T08:00","2022-11-23T09:00","2022-11-23T10:00","2022-11-23T11:00","2022-11-23T12:00","2022-11-23T13:00","2022-11-23T14:00","2022-11-23T15:00","2022-11-23T16:00","2022-11-23T17:00","2022-11-23T18:00","2022-11-23T19:00","2022-11-23T20:00","2022-11-23T21:00","2022-11-23T22:00","2022-11-23T23:00","2022-11-24T00:00","2022-11-24T01:00","2022-11-24T02:00","2022-11-24T03:00","2022-11-24T04:00","2022-11-24T05:00","2022-11-24T06:00","2022-11-24T07:00","2022-11-24T08:00","2022-11-24T09:00","2022-11-24T10:00","2022-11-24T11:00","2022-11-24T12:00","2022-11-24T13:00","2022-11-24T14:00","2022-11-24T15:00","2022-11-24T16:00","2022-11-24T17:00","2022-11-24T18:00","2022-11-24T19:00","2022-11-24T20:00","2022-11-24T21:00","2022-11-24T22:00","2022-11-24T23:00","2022-11-25T00:00","2022-11-25T01:00","2022-11-25T02:00","2022-11-25T03:00","2022-11-25T04:00","2022-11-25T05:00","2022-11-25T06:00","2022-11-25T07:00","2022-11-25T08:00","2022-11-25T09:00","2022-11-25T10:00","2022-11-25T11:00","2022-11-25T12:00","2022-11-25T13:00","2022-11-25T14:00","2022-11-25T15:00","2022-11-25T16:00","2022-11-25T17:00","2022-11-25T18:00","2022-11-25T19:00","2022-11-25T20:00","2022-11-25T21:00","2022-11-25T22:00","2022-11-25T23:00","2022-11-26T00:00","2022-11-26T01:00","2022-11-26T02:00","2022-11-26T03:00","2022-11-26T04:00","2022-11-26T05:00","2022-11-26T06:00","2022-11-26T07:00","2022-11-26T08:00","2022-11-26T09:00","2022-11-26T10:00","2022-11-26T11:00","2022-11-26T12:00","2022-11-26T13:00","2022-11-26T14:00","2022-11-26T15:00","2022-11-26T16:00","2022-11-26T17:00","2022-11-26T18:00","2022-11-26T19:00","2022-11-26T20:00","2022-11-26T21:00","2022-11-26T22:00","2022-11-26T23:00","2022-11-27T00:00","2022-11-27T01:00","2022-11-27T02:00","2022-11-27T03:00","2022-11-27T04:00","2022-11-27T05:00","2022-11-27T06:00","2022-11-27T07:00","2022-11-27T08:00","2022-11-27T09:00","2022-11-27T10:00","2022-11-27T11:00","2022-11-27T12:00","2022-11-27T13:00","2022-11-27T14:00","2022-11-27T15:00","2022-11-27T16:00","2022-11-27T17:00","2022-11-27T18:00","2022-11-27T19:00","2022-11-27T20:00","2022-11-27T21:00","2022-11-27T22:00","2022-11-27T23:00"],"temperature_2m":[11.0,11.1,10.9,10.8,10.5,10.5,10.7,9.4,7.9,6.6,7.0,7.3,7.3,7.5,7.2,6.4,5.7,5.4,5.0,4.8,4.7,4.7,4.4,4.1,3.9,3.5,3.2,2.9,2.6,2.4,2.0,2.8,4.4,5.8,7.5,8.6,9.4,9.8,10.0,9.6,8.8,8.2,7.7,7.6,7.6,7.6,7.3,7.1,6.9,7.0,6.8,6.8,6.8,7.0,7.2,7.4,8.2,9.1,9.8,10.5,11.1,11.4,11.3,10.3,9.4,8.8,8.5,8.1,7.6,7.1,6.6,6.2,5.6,5.0,4.8,4.5,4.4,4.7,4.7,5.7,7.0,8.6,9.4,10.1,10.4,9.8,8.7,7.4,6.8,6.4,5.9,5.7,5.5,5.2,5.0,4.8,4.6,4.5,4.4,4.3,4.2,4.0,4.2,4.9,5.9,7.2,7.9,8.6,9.0,8.8,8.2,7.4,6.7,6.0,5.2,4.8,4.5,4.0,3.5,2.9,2.3,1.6,1.0,0.2,-0.5,-1.1,-1.3,-0.6,0.5,2.2,3.7,5.4,7.1,7.5,7.4,6.8,6.1,5.1,3.7,2.8,1.9,0.9,0.3,-0.2,-0.6,-0.9,-1.0,-1.2,-1.3,-1.4,-1.2,-0.6,0.3,1.8,3.3,5.0,6.6,6.8,6.4,5.7,5.1,4.4,3.6,3.4,3.3,3.3,3.4,3.5]}}';
-- EXEC InsertCurrentWeatherAndWeatherForecast 'Sofia', @json;
